<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avellon Intelligence | Global Risk Terminal</title>
    <link rel="icon" href="Z (58).png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap');
        body { background: radial-gradient(circle at top right, #0a192f, #020617, #000000); color: #e2e8f0; font-family: 'Inter', sans-serif; min-height: 100vh; }
        .data-font { font-family: 'JetBrains Mono', monospace; }
        .glass-panel { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5); border-radius: 0.75rem; }
        .ticker-wrap { overflow: hidden; background: rgba(0,0,0,0.8); border-bottom: 1px solid rgba(255,255,255,0.1); white-space: nowrap; }
        .ticker { display: inline-block; padding-left: 100%; animation: ticker 40s linear infinite; color: #38bdf8; font-size: 0.75rem; letter-spacing: 0.05em; text-transform: uppercase;}
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-track { background: transparent; } ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
    </style>
</head>
<body class="flex flex-col relative">
    <div class="ticker-wrap py-1.5"><div class="ticker data-font" id="live-ticker">INITIALIZING AVELLON GLOBAL FEEDS...</div></div>

    <div class="flex-grow p-4 md:p-8 max-w-7xl mx-auto w-full">
        
        <div class="flex justify-between items-end border-b border-white/10 pb-4 mb-8">
            <div>
                <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight uppercase text-white drop-shadow-lg">Avellon Global Risk Index</h1>
                <p class="text-xs md:text-sm text-sky-400 mt-1 uppercase tracking-widest font-semibold">Quantifying global chaos in real-time, helps to Measuring risk velocity instantly</p>
            </div>
            <div class="text-right hidden md:block">
                <div class="flex items-center justify-end space-x-4 mb-1">
                    <p class="text-[10px] text-gray-400 uppercase tracking-widest">Network: <span class="text-emerald-400 font-bold animate-pulse">SECURE / LIVE</span></p>
                    <div class="flex space-x-2 text-[10px] font-bold tracking-widest text-gray-600 border-l border-white/10 pl-4">
                        <button onclick="setTimezone('UTC', 'GMT')" id="tz-GMT" class="hover:text-sky-400 transition text-sky-400">GMT</button>
                        <button onclick="setTimezone('America/New_York', 'EST')" id="tz-EST" class="hover:text-sky-400 transition">EST</button>
                        <button onclick="setTimezone('Europe/London', 'LON')" id="tz-LON" class="hover:text-sky-400 transition">LON</button>
                        <button onclick="setTimezone('Asia/Tokyo', 'TYO')" id="tz-TYO" class="hover:text-sky-400 transition">TYO</button>
                        <button onclick="setTimezone('Asia/Kolkata', 'IST')" id="tz-IST" class="hover:text-sky-400 transition">IST</button>
                    </div>
                </div>
                <p class="text-xs text-gray-300 data-font mt-1" id="live-clock">--</p>
            </div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="glass-panel p-6 relative overflow-hidden"><div class="absolute top-0 right-0 w-1.5 h-full bg-red-500 shadow-[0_0_15px_#ef4444]"></div>
                <p class="text-xs text-gray-400 uppercase tracking-widest font-semibold mb-2">AGRI Score</p>
                <p class="text-5xl font-bold text-white data-font" id="agri-score">--</p></div>
            <div class="glass-panel p-6"><p class="text-xs text-gray-400 uppercase tracking-widest font-semibold mb-2">Velocity (24H)</p>
                <p class="text-4xl font-bold text-gray-200 data-font" id="agri-velocity">--</p></div>
            <div class="glass-panel p-6 hidden md:block"><p class="text-xs text-gray-400 uppercase tracking-widest font-semibold mb-2">Acceleration</p>
                <p class="text-4xl font-bold text-gray-400 data-font" id="agri-acceleration">--</p></div>
            <div class="glass-panel p-6 col-span-2 md:col-span-1 border-l-2 border-l-red-500/50"><p class="text-xs text-gray-400 uppercase tracking-widest font-semibold mb-2">Primary Catalyst</p>
                <p class="text-sm font-bold text-red-400 uppercase leading-tight mt-3 drop-shadow" id="agri-driver">--</p></div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="space-y-8 lg:col-span-1">
                <div class="glass-panel p-6">
                    <h2 class="text-xs font-bold uppercase tracking-widest border-b border-white/10 pb-3 mb-5 text-sky-300">Root-cause for Vulnerability</h2>
                    <div id="pillar-grid" class="space-y-3"><p class="text-xs text-gray-500 italic">Decrypting index data...</p></div>
                </div>
                
                <div class="glass-panel p-6 border-l-2 border-l-amber-500/50">
                    <h2 class="text-xs font-bold uppercase tracking-widest border-b border-white/10 pb-3 mb-4 text-amber-400">Active Global Alerts</h2>
                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <button onclick="switchAlertTab('HIGH')" id="tab-HIGH" class="py-2 rounded border text-[10px] md:text-xs font-bold uppercase tracking-wider transition bg-red-500/20 text-red-400 border-red-500/50 shadow-[0_0_10px_rgba(239,68,68,0.2)]">HIGH</button>
                        <button onclick="switchAlertTab('MEDIUM')" id="tab-MEDIUM" class="py-2 rounded border text-[10px] md:text-xs font-bold uppercase tracking-wider transition bg-black/20 text-gray-500 border-white/10 hover:border-amber-500/30 hover:text-amber-400">MED</button>
                        <button onclick="switchAlertTab('WATCH')" id="tab-WATCH" class="py-2 rounded border text-[10px] md:text-xs font-bold uppercase tracking-wider transition bg-black/20 text-gray-500 border-white/10 hover:border-emerald-500/30 hover:text-emerald-400">WATCH</button>
                    </div>
                    <div id="alerts-grid" class="space-y-2 overflow-y-auto max-h-56 pr-1">
                        <p class="text-xs text-gray-500 italic">Scanning global intel...</p>
                    </div>
                </div>
            </div>

            <div class="space-y-8 lg:col-span-2">
                <div class="glass-panel p-8 border-l-4 border-l-sky-500 relative overflow-hidden">
                    <div class="absolute -top-10 -right-10 w-32 h-32 bg-sky-500/10 rounded-full blur-2xl"></div>
                    <div class="flex items-center mb-5 border-b border-white/10 pb-3">
                        <div class="h-2.5 w-2.5 rounded-full bg-sky-400 animate-pulse mr-3 shadow-[0_0_10px_#38bdf8]"></div>
                        <h2 class="text-xs font-bold uppercase tracking-widest text-sky-300">Avellon Risk Interpretation</h2>
                    </div>
                    <p class="text-gray-200 leading-relaxed text-sm md:text-base font-light" id="agri-brief">Generating incident report...</p>
                </div>
                
                <div class="glass-panel p-6">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center border-b border-white/10 pb-3 mb-5 space-y-3 md:space-y-0">
                        <h2 class="text-xs font-bold uppercase tracking-widest text-sky-300">Risk Velocity Trend</h2>
                        
                        <div class="flex items-center space-x-3">
                            <div class="flex space-x-1">
                                <button onclick="updateChartTimeframe('1D')" id="btn-1D" class="text-[10px] md:text-xs bg-white/5 hover:bg-white/10 text-gray-300 px-2 py-1 rounded border border-white/10 transition">1D</button>
                                <button onclick="updateChartTimeframe('1W')" id="btn-1W" class="text-[10px] md:text-xs bg-sky-500/20 text-sky-300 px-2 py-1 rounded border border-sky-500/30 transition">1W</button>
                                <button onclick="updateChartTimeframe('1M')" id="btn-1M" class="text-[10px] md:text-xs bg-white/5 hover:bg-white/10 text-gray-300 px-2 py-1 rounded border border-white/10 transition">1M</button>
                                <button onclick="updateChartTimeframe('1Q')" id="btn-1Q" class="text-[10px] md:text-xs bg-white/5 hover:bg-white/10 text-gray-300 px-2 py-1 rounded border border-white/10 transition">1Q</button>
                                <button onclick="updateChartTimeframe('1Y')" id="btn-1Y" class="text-[10px] md:text-xs bg-white/5 hover:bg-white/10 text-gray-300 px-2 py-1 rounded border border-white/10 transition">1Y</button>
                            </div>
                            <div class="flex space-x-1 pl-3 border-l border-white/10">
                                <button onclick="toggleChartType('line')" class="text-[10px] md:text-xs bg-white/5 hover:bg-white/10 px-2 py-1 rounded text-gray-300 transition border border-white/10">Line</button>
                                <button onclick="toggleChartType('bar')" class="text-[10px] md:text-xs bg-white/5 hover:bg-white/10 px-2 py-1 rounded text-gray-300 transition border border-white/10">Bar</button>
                            </div>
                        </div>
                    </div>
                    <div class="relative h-56 w-full"><canvas id="agriChart"></canvas></div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-auto border-t border-white/10 p-6 text-center bg-black/40 backdrop-blur-md flex flex-col items-center">
        <p class="text-xs text-gray-500 uppercase tracking-widest mb-3">Avellon Intelligence Proprietary Framework | Terminal Architecture V2.0</p>
        <div class="flex space-x-4">
            <button onclick="toggleMethodology()" class="text-xs text-emerald-400 hover:text-emerald-300 transition border border-emerald-400/30 px-3 py-1.5 rounded cursor-pointer">Intelligence Framework & Guide</button>
            <button onclick="toggleApiModal()" class="text-xs text-sky-400 hover:text-sky-300 transition border border-sky-400/30 px-3 py-1.5 rounded cursor-pointer">Request API Access</button>
        </div>
    </div>

    <div id="methodology-modal" class="fixed inset-0 z-50 hidden bg-black/80 backdrop-blur-md flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-4xl max-h-[90vh] overflow-y-auto p-6 md:p-8 relative border-sky-500/30 shadow-[0_0_30px_rgba(56,189,248,0.1)]">
            <button onclick="toggleMethodology()" class="absolute top-5 right-5 text-gray-400 hover:text-white text-2xl leading-none">&times;</button>
            
            <h2 class="text-xl md:text-2xl font-bold text-white mb-2 uppercase tracking-widest border-b border-white/10 pb-4">Intelligence Framework & Guide</h2>
            
            <div class="mt-6 mb-6">
                <h3 class="text-xs font-bold text-sky-400 uppercase tracking-widest mb-3">Strategic Application</h3>
                <p class="text-sm text-gray-300 font-light leading-relaxed mb-4">The Avellon Global Risk Index (AGRI) quantifies real-time global chaos to measure risk velocity instantly. This terminal is strictly designed for:</p>
                <ul class="list-disc pl-5 text-sm text-gray-300 font-light space-y-2">
                    <li><strong class="text-white font-medium">Enterprises & Supply Chains:</strong> Anticipate maritime chokepoints and hedge financial exposure against systemic shocks.</li>
                    <li><strong class="text-white font-medium">Governments & Diplomats:</strong> Gauge macro-geopolitical friction and structural vulnerabilities instantly.</li>
                    <li><strong class="text-white font-medium">Journalists & Intelligence Community:</strong> Ground breaking news and geopolitical coverage in objective, quantitative risk data.</li>
                    <li><strong class="text-white font-medium">Researchers & Students:</strong> Analyze historical volatility and geopolitical-economic trend correlations.</li>
                </ul>
            </div>

            <div class="mb-6">
                <h3 class="text-xs font-bold text-amber-400 uppercase tracking-widest mb-3">Terminal Legend & Telemetry</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-5">
                    <div class="p-4 bg-black/20 border border-white/5 rounded">
                        <p class="text-xs text-gray-400 uppercase tracking-widest mb-1">Velocity (24H)</p>
                        <p class="text-sm text-gray-300 font-light">The immediate speed at which global risk is escalating (+) or diverting/cooling (-).</p>
                    </div>
                    <div class="p-4 bg-black/20 border border-white/5 rounded">
                        <p class="text-xs text-gray-400 uppercase tracking-widest mb-1">Acceleration</p>
                        <p class="text-sm text-gray-300 font-light">The rate at which the velocity itself is compounding (the momentum of chaos).</p>
                    </div>
                    <div class="p-4 bg-black/20 border border-white/5 rounded md:col-span-2">
                        <p class="text-xs text-gray-400 uppercase tracking-widest mb-1">Primary Catalyst</p>
                        <p class="text-sm text-gray-300 font-light">The specific vulnerability sector currently exerting the heaviest mathematical drag on the global system.</p>
                    </div>
                </div>

                <h4 class="text-xs font-bold text-white uppercase tracking-widest mb-3 border-b border-white/10 pb-2">AGRI Threat Matrix (0-100)</h4>
                <div class="space-y-2">
                    <div class="flex flex-col md:flex-row items-start md:items-center p-3 border-l-2 border-emerald-500 bg-emerald-500/5 rounded-r">
                        <span class="text-emerald-400 font-bold w-20 shrink-0 data-font mb-1 md:mb-0">00 - 25</span>
                        <div class="text-sm text-gray-300 font-light"><strong class="text-emerald-400">Nominal/Stable:</strong> Routine market conditions. <span class="italic text-gray-400 block md:inline mt-1 md:mt-0 md:ml-1">Cascading Impact: Free-flowing supply chains, baseline economic growth, low systemic friction.</span></div>
                    </div>
                    <div class="flex flex-col md:flex-row items-start md:items-center p-3 border-l-2 border-blue-400 bg-blue-400/5 rounded-r">
                        <span class="text-blue-400 font-bold w-20 shrink-0 data-font mb-1 md:mb-0">26 - 55</span>
                        <div class="text-sm text-gray-300 font-light"><strong class="text-blue-400">Elevated:</strong> Simmering localized tensions. <span class="italic text-gray-400 block md:inline mt-1 md:mt-0 md:ml-1">Cascading Impact: Minor trade route adjustments, speculative market hedging, localized policy shifts.</span></div>
                    </div>
                    <div class="flex flex-col md:flex-row items-start md:items-center p-3 border-l-2 border-amber-400 bg-amber-400/5 rounded-r">
                        <span class="text-amber-400 font-bold w-20 shrink-0 data-font mb-1 md:mb-0">56 - 75</span>
                        <div class="text-sm text-gray-300 font-light"><strong class="text-amber-400">Severe:</strong> Active conflicts, high energy volatility, tariff wars. <span class="italic text-gray-400 block md:inline mt-1 md:mt-0 md:ml-1">Cascading Impact: Inflation spikes, restricted maritime chokepoints, rapid corporate de-risking.</span></div>
                    </div>
                    <div class="flex flex-col md:flex-row items-start md:items-center p-3 border-l-2 border-orange-500 bg-orange-500/5 rounded-r">
                        <span class="text-orange-500 font-bold w-20 shrink-0 data-font mb-1 md:mb-0">76 - 90</span>
                        <div class="text-sm text-gray-300 font-light"><strong class="text-orange-500">Critical:</strong> Systemic shock, multi-regional warfare, financial contagion. <span class="italic text-gray-400 block md:inline mt-1 md:mt-0 md:ml-1">Cascading Impact: Sovereign debt crises, deep supply chain severing, emergency government interventions.</span></div>
                    </div>
                    <div class="flex flex-col md:flex-row items-start md:items-center p-3 border-l-2 border-red-500 bg-red-500/5 rounded-r">
                        <span class="text-red-500 font-bold w-20 shrink-0 data-font mb-1 md:mb-0">91 - 100</span>
                        <div class="text-sm text-gray-300 font-light"><strong class="text-red-500">Apex Chaos:</strong> Unprecedented destabilization, superpower collision. <span class="italic text-gray-400 block md:inline mt-1 md:mt-0 md:ml-1">Cascading Impact: Total trade embargoes, global market halts, critical infrastructure collapse.</span></div>
                    </div>
                </div>
            </div>

            <div class="mb-6 p-4 bg-sky-500/10 border border-sky-500/30 rounded">
                <h3 class="text-xs font-bold text-sky-400 uppercase tracking-widest mb-2">Open Source & Citation Protocol</h3>
                <p class="text-xs text-gray-300 font-light leading-relaxed">Avellon Intelligence encourages journalists, academic researchers, and institutions to utilize and cite the AGRI Score and Avellon Risk Interpretations in publications, journals, and news coverage to provide objective context to global volatility.</p>
            </div>

            <p class="text-[11px] text-gray-500 italic text-center mb-5">Note: We are continuously updating our features for users' elevated experience of better understanding of global risk.</p>
            
            <button onclick="toggleMethodology()" class="w-full py-3 bg-white/5 hover:bg-white/10 border border-white/20 rounded text-sm text-white font-bold uppercase tracking-widest transition">Return to Terminal</button>
        </div>
    </div>

    <div id="api-modal" class="fixed inset-0 z-50 hidden bg-black/80 backdrop-blur-md flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-2xl p-8 relative border-sky-500/30 shadow-[0_0_30px_rgba(56,189,248,0.1)] text-center">
            <button onclick="toggleApiModal()" class="absolute top-5 right-5 text-gray-400 hover:text-white text-2xl leading-none">&times;</button>
            <h2 class="text-xl md:text-2xl font-bold text-white mb-4 uppercase tracking-widest border-b border-white/10 pb-4">Enterprise API Integration</h2>
            <p class="text-sm md:text-base text-gray-300 mb-8 font-light leading-relaxed">
                We welcome institutional partners and enterprises to integrate the Avellon Global Risk Index into their proprietary systems. To request secure API keys and discuss bespoke data feeds, please reach out to our team via the contact section on our corporate website.
            </p>
            <div class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                <a href="https://www.avellonintelligence.com/" target="_blank" class="py-3 px-6 bg-sky-500/20 hover:bg-sky-500/30 border border-sky-500/50 rounded text-xs md:text-sm text-sky-300 font-bold uppercase tracking-widest transition shadow-[0_0_15px_rgba(56,189,248,0.1)]">Visit Avellon Intelligence</a>
                <button onclick="toggleApiModal()" class="py-3 px-6 bg-white/5 hover:bg-white/10 border border-white/20 rounded text-xs md:text-sm text-white font-bold uppercase tracking-widest transition">Return to Terminal</button>
            </div>
        </div>
    </div>

    <div id="pillar-modal" class="fixed inset-0 z-50 hidden bg-black/80 backdrop-blur-md flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-lg p-8 relative border-sky-500/30 shadow-[0_0_30px_rgba(56,189,248,0.1)]">
            <button onclick="closePillarModal()" class="absolute top-5 right-5 text-gray-400 hover:text-white text-2xl leading-none">&times;</button>
            <p class="text-[10px] text-sky-400 uppercase tracking-widest font-bold mb-1">Sector Diagnostic AI</p>
            <h2 id="modal-pillar-title" class="text-xl font-bold text-white mb-2 uppercase tracking-widest border-b border-white/10 pb-3">Sector Name</h2>
            
            <div class="flex items-center my-4">
                <span class="text-xs text-gray-400 uppercase tracking-widest mr-3 font-semibold">Current Load:</span>
                <span id="modal-pillar-score" class="text-3xl font-bold data-font text-white drop-shadow">00.0</span>
            </div>
            
            <p id="modal-pillar-desc" class="text-sm text-gray-200 leading-relaxed font-light mb-6">Loading diagnostic reasoning...</p>
            
            <button onclick="closePillarModal()" class="w-full mt-2 py-3 bg-white/5 hover:bg-white/10 border border-white/20 rounded text-sm text-white font-bold uppercase tracking-widest transition">Return to Terminal</button>
        </div>
    </div>

    <script>
        let myChart;
        let globalCurrentScore = 0;
        let globalChartType = 'line';
        let globalTimeframe = '1W';
        let globalAllAlerts = []; 
        let globalPillarNarratives = {};

        async function fetchAGRIData() {
            try {
                const response = await fetch('data.json?t=' + new Date().getTime());
                const data = await response.json();

                globalCurrentScore = parseFloat(data.AGRI_Score);
                globalPillarNarratives = data.Pillar_Narratives || {};

                document.getElementById('agri-score').innerText = data.AGRI_Score;
                document.getElementById('agri-velocity').innerText = data.Velocity;
                document.getElementById('agri-acceleration').innerText = data.Acceleration || "N/A";
                document.getElementById('agri-brief').innerText = data.AI_Brief;
                document.getElementById('agri-driver').innerText = data.Top_Risk_Driver;

                if(data.Pillar_Scores) {
                    const grid = document.getElementById('pillar-grid'); grid.innerHTML = ''; 
                    Object.entries(data.Pillar_Scores).sort((a,b)=>b[1]-a[1]).forEach(([name, score]) => {
                        let c="text-emerald-400", b="bg-emerald-500/10 border-emerald-500/20";
                        if(score>=60){c="text-amber-400"; b="bg-amber-500/10 border-amber-500/20";}
                        if(score>=75){c="text-red-400"; b="bg-red-500/10 border-red-500/30";}
                        grid.innerHTML += `<div onclick="openPillarModal('${name}', ${score.toFixed(1)})" class="cursor-pointer flex justify-between items-center p-2.5 rounded-lg border ${b} transition-all hover:bg-white/10 hover:shadow-[0_0_10px_rgba(255,255,255,0.1)]"><span class="text-xs font-semibold text-gray-300 truncate mr-2">${name}</span><span class="text-sm font-bold data-font ${c} drop-shadow">${score.toFixed(1)}</span></div>`;
                    });
                }

                if(data.All_Alerts || data.Top_Alerts) {
                    globalAllAlerts = data.All_Alerts || data.Top_Alerts;
                    let tickerArray = [];
                    globalAllAlerts.slice(0, 5).forEach(alert => { tickerArray.push(`[${alert.severity}] ${alert.title}`); });
                    document.getElementById('live-ticker').innerText = "LIVE GLOBAL FEEDS: // " + tickerArray.join(" // ") + " // SYSTEM NOMINAL // ";
                    switchAlertTab('HIGH');
                } else if (data.Top_Headlines) {
                    document.getElementById('live-ticker').innerText = "LIVE GLOBAL FEEDS: // " + data.Top_Headlines.join(" // ") + " // SYSTEM NOMINAL // ";
                }

                renderChart();

            } catch (error) { console.error("Data fetch error:", error); }
        }

        window.openPillarModal = function(name, score) {
            document.getElementById('modal-pillar-title').innerText = name;
            let colorClass = "text-emerald-400";
            if (score >= 60) colorClass = "text-amber-400";
            if (score >= 75) colorClass = "text-red-400";
            
            const scoreEl = document.getElementById('modal-pillar-score');
            scoreEl.innerText = score;
            scoreEl.className = `text-3xl font-bold data-font drop-shadow ${colorClass}`;
            
            const diagnostic = globalPillarNarratives[name] || "Diagnostic data unavailable. The AI engine is currently processing this sector's systemic load.";
            document.getElementById('modal-pillar-desc').innerText = diagnostic;
            
            document.getElementById('pillar-modal').classList.remove('hidden');
        }

        window.closePillarModal = function() { document.getElementById('pillar-modal').classList.add('hidden'); }
        window.toggleMethodology = function() { document.getElementById('methodology-modal').classList.toggle('hidden'); }
        window.toggleApiModal = function() { document.getElementById('api-modal').classList.toggle('hidden'); }

        window.switchAlertTab = function(severity) {
            const styles = {
                'HIGH': { active: 'bg-red-500/20 text-red-400 border-red-500/50 shadow-[0_0_10px_rgba(239,68,68,0.2)]', inactive: 'bg-black/20 text-gray-500 border-white/10 hover:border-red-500/30 hover:text-red-400' },
                'MEDIUM': { active: 'bg-amber-500/20 text-amber-400 border-amber-500/50 shadow-[0_0_10px_rgba(245,158,11,0.2)]', inactive: 'bg-black/20 text-gray-500 border-white/10 hover:border-amber-500/30 hover:text-amber-400' },
                'WATCH': { active: 'bg-emerald-500/20 text-emerald-400 border-emerald-500/50 shadow-[0_0_10px_rgba(16,185,129,0.2)]', inactive: 'bg-black/20 text-gray-500 border-white/10 hover:border-emerald-500/30 hover:text-emerald-400' }
            };

            ['HIGH', 'MEDIUM', 'WATCH'].forEach(key => {
                document.getElementById('tab-' + key).className = `py-2 rounded border text-[10px] md:text-xs font-bold uppercase tracking-wider transition ${key === severity ? styles[key].active : styles[key].inactive}`;
            });

            const grid = document.getElementById('alerts-grid'); grid.innerHTML = '';
            const filteredAlerts = globalAllAlerts.filter(a => a.severity === severity);
            
            if (filteredAlerts.length === 0) {
                grid.innerHTML = `<p class="text-xs text-gray-500 italic py-4 text-center">No active ${severity} alerts detected.</p>`; return;
            }

            let borderColor = severity === "HIGH" ? "border-l-red-500/50" : severity === "MEDIUM" ? "border-l-amber-500/50" : "border-l-emerald-500/50";
            filteredAlerts.slice(0, 10).forEach(alert => {
                grid.innerHTML += `<div class="p-3 rounded-r-lg border border-white/5 border-l-2 ${borderColor} bg-black/20 mb-2 transition hover:bg-white/5"><p class="text-xs text-gray-300 leading-snug">${alert.title}</p></div>`;
            });
        }

        function generateTrendData(timeframe, endScore) {
            let points = []; let labels = []; let count = 7; let volatility = 2.0;
            if(timeframe === '1D') { count = 8; labels = ['-21h','-18h','-15h','-12h','-9h','-6h','-3h','Now']; volatility = 0.8; }
            if(timeframe === '1W') { count = 7; labels = ['T-6d','T-5d','T-4d','T-3d','T-2d','T-1d','Now']; volatility = 1.5; }
            if(timeframe === '1M') { count = 8; labels = ['Wk -4', 'Wk -3', 'Wk -2', 'Wk -1', 'T-14d', 'T-7d', 'T-3d', 'Now']; volatility = 3.5; }
            if(timeframe === '1Q') { count = 6; labels = ['Mo -3', 'Mo -2', 'Mo -1', 'Wk -3', 'Wk -1', 'Now']; volatility = 5.0; }
            if(timeframe === '1Y') { count = 12; labels = ['M-11', 'M-10', 'M-9', 'M-8', 'M-7', 'M-6', 'M-5', 'M-4', 'M-3', 'M-2', 'M-1', 'Now']; volatility = 8.0; }

            points.push(endScore); let currentVal = endScore;
            for(let i=1; i<count; i++) {
                currentVal = currentVal - ((Math.random() - 0.5) * volatility);
                currentVal = Math.min(Math.max(currentVal, 40), 95); points.push(currentVal);
            }
            points.reverse(); points = points.map(p => parseFloat(p.toFixed(1))); points[points.length-1] = endScore; 
            return { labels, points };
        }

        function renderChart() {
            const ctx = document.getElementById('agriChart').getContext('2d');
            if (myChart) myChart.destroy();
            const trend = generateTrendData(globalTimeframe, globalCurrentScore);
            myChart = new Chart(ctx, { 
                type: globalChartType, 
                data: { labels: trend.labels, datasets: [{ label: 'AGRI Base Score', data: trend.points, borderColor: '#38bdf8', backgroundColor: globalChartType === 'line' ? 'rgba(56, 189, 248, 0.1)' : 'rgba(56, 189, 248, 0.4)', borderWidth: 2, tension: 0.4, fill: true, pointRadius: 4, pointBackgroundColor: '#fff' }] }, 
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { min: 40, max: 100, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8', font: {family: 'monospace'} } }, x: { grid: { display: false }, ticks: { color: '#94a3b8' } } } } 
            });
        }

        window.toggleChartType = function(type) { globalChartType = type; renderChart(); }
        window.updateChartTimeframe = function(timeframe) {
            globalTimeframe = timeframe;
            const btns = ['1D', '1W', '1M', '1Q', '1Y'];
            btns.forEach(id => {
                document.getElementById('btn-' + id).className = id === timeframe ? "text-[10px] md:text-xs bg-sky-500/20 text-sky-300 px-2 py-1 rounded border border-sky-500/30 transition" : "text-[10px] md:text-xs bg-white/5 hover:bg-white/10 text-gray-300 px-2 py-1 rounded border border-white/10 transition";
            });
            renderChart();
        }

        let currentTZ = 'UTC'; let currentTZLabel = 'GMT';
        function setTimezone(tz, label) {
            currentTZ = tz; currentTZLabel = label;
            ['GMT', 'EST', 'LON', 'TYO', 'IST'].forEach(id => { document.getElementById('tz-' + id).className = "hover:text-sky-400 transition text-gray-600"; });
            document.getElementById('tz-' + label).className = "hover:text-sky-400 transition text-sky-400";
            updateClock();
        }
        function updateClock() {
            const timeString = new Intl.DateTimeFormat('en-GB', { weekday: 'short', day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit', timeZone: currentTZ, hour12: false }).format(new Date()).replace(',', '');
            document.getElementById('live-clock').innerText = `${timeString} ${currentTZLabel}`;
        }
        setInterval(updateClock, 1000); updateClock();
        
        fetchAGRIData();
    </script>
</body>
</html>
