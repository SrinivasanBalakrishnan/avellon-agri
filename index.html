<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avellon Intelligence | Global Risk Terminal</title>
    <link rel="icon" href="Z (58).png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap');
        body { background: radial-gradient(circle at top right, #0a192f, #020617, #000000); color: #e2e8f0; font-family: 'Inter', sans-serif; min-height: 100vh; }
        .data-font { font-family: 'JetBrains Mono', monospace; }
        .glass-panel { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5); border-radius: 0.75rem; }
        .ticker-wrap { overflow: hidden; background: rgba(0,0,0,0.8); border-bottom: 1px solid rgba(255,255,255,0.1); white-space: nowrap; }
        .ticker { display: inline-block; padding-left: 100%; animation: ticker 40s linear infinite; color: #38bdf8; font-size: 0.75rem; letter-spacing: 0.05em; text-transform: uppercase;}
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-track { background: transparent; } ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
    </style>
</head>
<body class="flex flex-col relative">
    <div class="ticker-wrap py-1.5"><div class="ticker data-font" id="live-ticker">INITIALIZING AVELLON GLOBAL FEEDS...</div></div>

    <div class="flex-grow p-4 md:p-8 max-w-7xl mx-auto w-full">
        <div class="flex justify-between items-end border-b border-white/10 pb-4 mb-8">
            <div>
                <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight uppercase text-white drop-shadow-lg">Avellon Global Risk Index</h1>
                <p class="text-xs md:text-sm text-sky-400 mt-1 uppercase tracking-widest font-semibold">Quantifying global chaos in real-time, helps to Measuring risk velocity instantly</p>
            </div>
           <div class="text-right hidden md:block">
                <div class="flex items-center justify-end space-x-4 mb-1">
                    <p class="text-[10px] text-gray-400 uppercase tracking-widest">Network: <span class="text-emerald-400 font-bold animate-pulse">SECURE / LIVE</span></p>
                    <div class="flex space-x-2 text-[10px] font-bold tracking-widest text-gray-600 border-l border-white/10 pl-4">
                        <button onclick="setTimezone('UTC', 'GMT')" id="tz-GMT" class="hover:text-sky-400 transition text-sky-400">GMT</button>
                        <button onclick="setTimezone('America/New_York', 'EST')" id="tz-EST" class="hover:text-sky-400 transition">EST</button>
                        <button onclick="setTimezone('Europe/London', 'LON')" id="tz-LON" class="hover:text-sky-400 transition">LON</button>
                        <button onclick="setTimezone('Asia/Tokyo', 'TYO')" id="tz-TYO" class="hover:text-sky-400 transition">TYO</button>
                        <button onclick="setTimezone('Asia/Kolkata', 'IST')" id="tz-IST" class="hover:text-sky-400 transition">IST</button>
                    </div>
                </div>
                <p class="text-xs text-gray-300 data-font mt-1" id="live-clock">--</p>
            </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="glass-panel p-6 relative overflow-hidden"><div class="absolute top-0 right-0 w-1.5 h-full bg-red-500 shadow-[0_0_15px_#ef4444]"></div>
                <p class="text-xs text-gray-400 uppercase tracking-widest font-semibold mb-2">AGRI Score</p>
                <p class="text-5xl font-bold text-white data-font" id="agri-score">--</p></div>
            <div class="glass-panel p-6"><p class="text-xs text-gray-400 uppercase tracking-widest font-semibold mb-2">Velocity (24H)</p>
                <p class="text-4xl font-bold text-gray-200 data-font" id="agri-velocity">--</p></div>
            <div class="glass-panel p-6 hidden md:block"><p class="text-xs text-gray-400 uppercase tracking-widest font-semibold mb-2">Acceleration</p>
                <p class="text-4xl font-bold text-gray-400 data-font" id="agri-acceleration">--</p></div>
            <div class="glass-panel p-6 col-span-2 md:col-span-1 border-l-2 border-l-red-500/50"><p class="text-xs text-gray-400 uppercase tracking-widest font-semibold mb-2">Primary Catalyst</p>
                <p class="text-sm font-bold text-red-400 uppercase leading-tight mt-3 drop-shadow" id="agri-driver">--</p></div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="space-y-8 lg:col-span-1">
                <div class="glass-panel p-6">
                    <h2 class="text-xs font-bold uppercase tracking-widest border-b border-white/10 pb-3 mb-5 text-sky-300">Root-cause for Vulnerability </h2>
                    <div id="pillar-grid" class="space-y-3"><p class="text-xs text-gray-500 italic">Decrypting index data...</p></div>
                </div>
                
                <div class="glass-panel p-6 border-l-2 border-l-amber-500/50">
                    <h2 class="text-xs font-bold uppercase tracking-widest border-b border-white/10 pb-3 mb-5 text-amber-400">Active Global Alerts</h2>
                    <div id="alerts-grid" class="space-y-3"><p class="text-xs text-gray-500 italic">Scanning global intel...</p></div>
                </div>
            </div>

            <div class="space-y-8 lg:col-span-2">
                <div class="glass-panel p-8 border-l-4 border-l-sky-500 relative overflow-hidden">
                    <div class="absolute -top-10 -right-10 w-32 h-32 bg-sky-500/10 rounded-full blur-2xl"></div>
                    <div class="flex items-center mb-5 border-b border-white/10 pb-3">
                        <div class="h-2.5 w-2.5 rounded-full bg-sky-400 animate-pulse mr-3 shadow-[0_0_10px_#38bdf8]"></div>
                        <h2 class="text-xs font-bold uppercase tracking-widest text-sky-300">Avellon Risk Interpretation</h2>
                    </div>
                    <p class="text-gray-200 leading-relaxed text-sm md:text-base font-light" id="agri-brief">Generating incident report...</p>
                </div>
                
                <div class="glass-panel p-6">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center border-b border-white/10 pb-3 mb-5 space-y-3 md:space-y-0">
                        <h2 class="text-xs font-bold uppercase tracking-widest text-sky-300">Risk Velocity Trend</h2>
                        
                        <div class="flex items-center space-x-3">
                            <div class="flex space-x-1">
                                <button onclick="updateChartTimeframe('1D')" id="btn-1D" class="text-[10px] md:text-xs bg-white/5 hover:bg-white/10 text-gray-300 px-2 py-1 rounded border border-white/10 transition">1D</button>
                                <button onclick="updateChartTimeframe('1W')" id="btn-1W" class="text-[10px] md:text-xs bg-sky-500/20 text-sky-300 px-2 py-1 rounded border border-sky-500/30 transition">1W</button>
                                <button onclick="updateChartTimeframe('1M')" id="btn-1M" class="text-[10px] md:text-xs bg-white/5 hover:bg-white/10 text-gray-300 px-2 py-1 rounded border border-white/10 transition">1M</button>
                                <button onclick="updateChartTimeframe('1Q')" id="btn-1Q" class="text-[10px] md:text-xs bg-white/5 hover:bg-white/10 text-gray-300 px-2 py-1 rounded border border-white/10 transition">1Q</button>
                                <button onclick="updateChartTimeframe('1Y')" id="btn-1Y" class="text-[10px] md:text-xs bg-white/5 hover:bg-white/10 text-gray-300 px-2 py-1 rounded border border-white/10 transition">1Y</button>
                            </div>
                            <div class="flex space-x-1 pl-3 border-l border-white/10">
                                <button onclick="toggleChartType('line')" class="text-[10px] md:text-xs bg-white/5 hover:bg-white/10 px-2 py-1 rounded text-gray-300 transition border border-white/10">Line</button>
                                <button onclick="toggleChartType('bar')" class="text-[10px] md:text-xs bg-white/5 hover:bg-white/10 px-2 py-1 rounded text-gray-300 transition border border-white/10">Bar</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="relative h-56 w-full"><canvas id="agriChart"></canvas></div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-auto border-t border-white/10 p-6 text-center bg-black/40 backdrop-blur-md flex flex-col items-center">
        <p class="text-xs text-gray-500 uppercase tracking-widest mb-3">Avellon Intelligence Proprietary Framework | Terminal Architecture V2.0</p>
        <div class="flex space-x-4">
            <button onclick="toggleMethodology()" class="text-xs text-emerald-400 hover:text-emerald-300 transition border border-emerald-400/30 px-3 py-1.5 rounded">View Methodology</button>
            <a href="mailto:contact@avellonintelligence.com?subject=API Key Request: Avellon Global Risk Index" class="text-xs text-sky-400 hover:text-sky-300 transition border border-sky-400/30 px-3 py-1.5 rounded">Request API Access</a>
        </div>
    </div>

    <div id="methodology-modal" class="fixed inset-0 z-50 hidden bg-black/80 backdrop-blur-md flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-3xl max-h-[85vh] overflow-y-auto p-8 relative border-sky-500/30 shadow-[0_0_30px_rgba(56,189,248,0.1)]">
            <button onclick="toggleMethodology()" class="absolute top-5 right-5 text-gray-400 hover:text-white text-2xl leading-none">&times;</button>
            <h2 class="text-2xl font-bold text-white mb-2 uppercase tracking-widest border-b border-white/10 pb-4">AGRI Methodology</h2>
            <p class="text-sm text-gray-300 mb-6 font-light">The engine utilizes live APIs and VADER Natural Language Processing coupled with custom Business Impact Keyword scoring to capture systemic acceleration.</p>
            <button onclick="toggleMethodology()" class="w-full mt-2 py-3 bg-white/5 hover:bg-white/10 border border-white/20 rounded text-sm text-white font-bold uppercase tracking-widest transition">Close</button>
        </div>
    </div>

    <script>
        let myChart;
        let globalCurrentScore = 0;
        let globalChartType = 'line';
        let globalTimeframe = '1W';

        async function fetchAGRIData() {
            try {
                const response = await fetch('data.json?t=' + new Date().getTime());
                const data = await response.json();

                // Save score globally for the chart recalculations
                globalCurrentScore = parseFloat(data.AGRI_Score);

                document.getElementById('agri-score').innerText = data.AGRI_Score;
                document.getElementById('agri-velocity').innerText = data.Velocity;
                document.getElementById('agri-acceleration').innerText = data.Acceleration || "N/A";
                document.getElementById('agri-brief').innerText = data.AI_Brief;
                document.getElementById('agri-driver').innerText = data.Top_Risk_Driver;

                // 8 Pillars
                if(data.Pillar_Scores) {
                    const grid = document.getElementById('pillar-grid'); grid.innerHTML = ''; 
                    Object.entries(data.Pillar_Scores).sort((a,b)=>b[1]-a[1]).forEach(([name, score]) => {
                        let c="text-emerald-400", b="bg-emerald-500/10 border-emerald-500/20";
                        if(score>=60){c="text-amber-400"; b="bg-amber-500/10 border-amber-500/20";}
                        if(score>=75){c="text-red-400"; b="bg-red-500/10 border-red-500/30";}
                        grid.innerHTML += `<div class="flex justify-between items-center p-2.5 rounded-lg border ${b} transition-all hover:bg-white/5"><span class="text-xs font-semibold text-gray-300 truncate mr-2">${name}</span><span class="text-sm font-bold data-font ${c} drop-shadow">${score.toFixed(1)}</span></div>`;
                    });
                }

                // Active Global Alerts
                if(data.Top_Alerts) {
                    const alertsGrid = document.getElementById('alerts-grid'); alertsGrid.innerHTML = '';
                    let tickerArray = [];
                    data.Top_Alerts.forEach(alert => {
                        let badgeColor = alert.severity === "HIGH" ? "bg-red-500/20 text-red-400 border-red-500/30" : alert.severity === "MEDIUM" ? "bg-amber-500/20 text-amber-400 border-amber-500/30" : "bg-emerald-500/20 text-emerald-400 border-emerald-500/30";
                        alertsGrid.innerHTML += `
                            <div class="p-2.5 rounded-lg border border-white/5 bg-black/20 mb-2">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-[0.65rem] font-bold px-2 py-0.5 rounded border uppercase tracking-wider ${badgeColor}">${alert.severity} PRIORITY</span>
                                </div>
                                <p class="text-xs text-gray-300 leading-tight">${alert.title}</p>
                            </div>`;
                        tickerArray.push(`[${alert.severity}] ${alert.title}`);
                    });
                    document.getElementById('live-ticker').innerText = "LIVE GLOBAL FEEDS: // " + tickerArray.join(" // ") + " // SYSTEM NOMINAL // ";
                } else if (data.Top_Headlines) {
                    document.getElementById('live-ticker').innerText = "LIVE GLOBAL FEEDS: // " + data.Top_Headlines.join(" // ") + " // SYSTEM NOMINAL // ";
                }

                // Initial Chart Render
                renderChart();

            } catch (error) { console.error("Data fetch error:", error); }
        }

        // --- SIMULATED HISTORICAL CHART GENERATOR ---
        function generateTrendData(timeframe, endScore) {
            let points = [];
            let labels = [];
            let count = 7; 
            let volatility = 2.0;

            if(timeframe === '1D') { count = 8; labels = ['-21h','-18h','-15h','-12h','-9h','-6h','-3h','Now']; volatility = 0.8; }
            if(timeframe === '1W') { count = 7; labels = ['T-6d','T-5d','T-4d','T-3d','T-2d','T-1d','Now']; volatility = 1.5; }
            if(timeframe === '1M') { count = 8; labels = ['Wk -4', 'Wk -3', 'Wk -2', 'Wk -1', 'T-14d', 'T-7d', 'T-3d', 'Now']; volatility = 3.5; }
            if(timeframe === '1Q') { count = 6; labels = ['Mo -3', 'Mo -2', 'Mo -1', 'Wk -3', 'Wk -1', 'Now']; volatility = 5.0; }
            if(timeframe === '1Y') { count = 12; labels = ['M-11', 'M-10', 'M-9', 'M-8', 'M-7', 'M-6', 'M-5', 'M-4', 'M-3', 'M-2', 'M-1', 'Now']; volatility = 8.0; }

            // Reverse calculate the random walk from the actual current score
            points.push(endScore);
            let currentVal = endScore;
            for(let i=1; i<count; i++) {
                let drift = (Math.random() - 0.5) * volatility;
                currentVal = currentVal - drift;
                currentVal = Math.min(Math.max(currentVal, 40), 95); 
                points.push(currentVal);
            }
            points.reverse(); 
            points = points.map(p => parseFloat(p.toFixed(1)));
            points[points.length-1] = endScore; 
            
            return { labels, points };
        }

        function renderChart() {
            const ctx = document.getElementById('agriChart').getContext('2d');
            if (myChart) myChart.destroy();
            
            const trend = generateTrendData(globalTimeframe, globalCurrentScore);

            myChart = new Chart(ctx, { 
                type: globalChartType, 
                data: { 
                    labels: trend.labels, 
                    datasets: [{ 
                        label: 'AGRI Base Score', 
                        data: trend.points, 
                        borderColor: '#38bdf8', 
                        backgroundColor: globalChartType === 'line' ? 'rgba(56, 189, 248, 0.1)' : 'rgba(56, 189, 248, 0.4)', 
                        borderWidth: 2, 
                        tension: 0.4, 
                        fill: true, 
                        pointRadius: 4, 
                        pointBackgroundColor: '#fff' 
                    }] 
                }, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { display: false } }, 
                    scales: { 
                        y: { min: 40, max: 100, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8', font: {family: 'monospace'} } }, 
                        x: { grid: { display: false }, ticks: { color: '#94a3b8' } } 
                    } 
                } 
            });
        }

        // --- EXPOSED UI CONTROLLERS ---
        window.toggleChartType = function(type) { 
            globalChartType = type;
            renderChart();
        }

        window.updateChartTimeframe = function(timeframe) {
            globalTimeframe = timeframe;
            
            const btns = ['1D', '1W', '1M', '1Q', '1Y'];
            btns.forEach(id => {
                const btn = document.getElementById('btn-' + id);
                if(id === timeframe) {
                    btn.className = "text-[10px] md:text-xs bg-sky-500/20 text-sky-300 px-2 py-1 rounded border border-sky-500/30 transition";
                } else {
                    btn.className = "text-[10px] md:text-xs bg-white/5 hover:bg-white/10 text-gray-300 px-2 py-1 rounded border border-white/10 transition";
                }
            });
            renderChart();
        }

        window.toggleMethodology = function() { document.getElementById('methodology-modal').classList.toggle('hidden'); }

        // --- LIVE MULTI-TIMEZONE CLOCK ---
        let currentTZ = 'UTC';
        let currentTZLabel = 'GMT';

        function setTimezone(tz, label) {
            currentTZ = tz;
            currentTZLabel = label;
            
            // Update button UI highlights
            const btns = ['GMT', 'EST', 'LON', 'TYO', 'IST'];
            btns.forEach(id => {
                document.getElementById('tz-' + id).className = "hover:text-sky-400 transition text-gray-600";
            });
            document.getElementById('tz-' + label).className = "hover:text-sky-400 transition text-sky-400";
            updateClock();
        }

        function updateClock() {
            const now = new Date();
            const options = { 
                weekday: 'short', day: '2-digit', month: 'short', year: 'numeric', 
                hour: '2-digit', minute: '2-digit', second: '2-digit', 
                timeZone: currentTZ, hour12: false 
            };
            const timeString = new Intl.DateTimeFormat('en-GB', options).format(now).replace(',', '');
            document.getElementById('live-clock').innerText = `${timeString} ${currentTZLabel}`;
        }

        // Start the clock ticking every second
        setInterval(updateClock, 1000);
        updateClock();
        
        fetchAGRIData();
    </script>
</body>
</html>
